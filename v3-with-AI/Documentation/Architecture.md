# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Telegram –±–æ—Ç–∞ —Å Yandex GPT

## –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-yandex-gpt-bot/
‚îú‚îÄ‚îÄ main.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞(–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ)
‚îî‚îÄ‚îÄ Technical task.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–°–ª–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Configuration Layer)**
```python
# –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ
API_TOKEN = "your_telegram_bot_token"
YANDEX_API_KEY = "your_yandex_api_key"
YANDEX_FOLDER_ID = "your_folder_id"
YANDEX_GPT_URL = "https://llm.api.cloud.yandex.net/..."
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
```python
# config.py
import os
from dataclasses import dataclass

@dataclass
class Config:
    API_TOKEN: str = os.getenv("TELEGRAM_BOT_TOKEN")
    YANDEX_API_KEY: str = os.getenv("YANDEX_API_KEY")
    YANDEX_FOLDER_ID: str = os.getenv("YANDEX_FOLDER_ID")
    YANDEX_GPT_URL: str = "https://llm.api.cloud.yandex.net/..."
```

### 2. **–°–ª–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (Initialization Layer)**
```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
bot = Bot(token=API_TOKEN)
dp = Dispatcher()
```

### 3. **–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Presentation Layer)**
#### 3.1 –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```python
def get_main_menu() -> ReplyKeyboardMarkup
def get_back_to_menu_keyboard() -> ReplyKeyboardMarkup
```

#### 3.2 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (Handlers)
```python
# –ö–æ–º–∞–Ω–¥—ã
@dp.message(Command("start"))
@dp.message(Command("menu")) 
@dp.message(Command("help"))
@dp.message(Command("status"))

# –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
@dp.message(lambda message: message.text == "‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞")
@dp.message(lambda message: message.text == "üîç –ü–æ–∏—Å–∫")
@dp.message(lambda message: message.text == "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")

# –û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞
@dp.message()
```

### 4. **–°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (Business Logic Layer)**
#### 4.1 –°–µ—Ä–≤–∏—Å Yandex GPT
```python
async def ask_yandex_gpt(question: str) -> str:
    """
    –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Yandex GPT API
    """
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞
    # –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

### 5. **–°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö (Data Layer)**
```python
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Yandex GPT –∑–∞–ø—Ä–æ—Å–∞
data = {
    "modelUri": f"gpt://{YANDEX_FOLDER_ID}/yandexgpt-lite",
    "completionOptions": {
        "stream": False,
        "temperature": 0.3,
        "maxTokens": 1500
    },
    "messages": [
        {
            "role": "system",
            "text": "–¢—ã - –ø–æ–ª–µ–∑–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç..."
        },
        {
            "role": "user",
            "text": question
        }
    ]
}
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data Flow)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram
        ‚Üì
Telegram Bot API
        ‚Üì
Aiogram Dispatcher
        ‚Üì
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        ‚Üì
–°–µ—Ä–≤–∏—Å Yandex GPT (ask_yandex_gpt)
        ‚Üì
Yandex Cloud LLM API
        ‚Üì
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
        ‚Üì
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

## –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

```
telegram-yandex-gpt-bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py      # –ö–æ–º–∞–Ω–¥—ã (/start, /help, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu.py          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ messages.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ builder.py
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yandex_gpt.py    # –°–µ—Ä–≤–∏—Å Yandex GPT
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ logger.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
+----------------+     +-----------------+     +-----------------+
|   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |     |  Telegram Bot   |     |   Yandex GPT    |
|    Telegram    |---->|     (Aiogram)   |---->|      API        |
+----------------+     +-----------------+     +-----------------+
         ‚Üë                      |                      |
         |                      |                      |
         +----------------------+----------------------+
         |             –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞               |
         +--------------------------------------------+
```

## –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. **–Ø–¥—Ä–æ –±–æ—Ç–∞ (Bot Core)**
- **Aiogram Dispatcher** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
- **Bot instance** - —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- **Middleware** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### 2. **–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏–π (State Management)**
```python
# –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - stateless
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ - FSM (Finite State Machine)
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext

class UserStates(StatesGroup):
    WAITING_FOR_QUESTION = State()
    IN_SEARCH_MODE = State()
```

### 3. **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (Service Layer)**
- **Yandex GPT Service** - –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ API –≤—ã–∑–æ–≤–æ–≤
- **Error Handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –∏ API
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### 4. **–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (View Layer)**
- **Keyboard Builders** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **Message Formatters** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- **Template System** - —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –æ–¥–∏–Ω —Ñ–∞–π–ª –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
2. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å** - –ª–∏–Ω–µ–π–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏** –¥–ª—è –ª—É—á—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ FSM** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –¥–∏–∞–ª–æ–≥–∞
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –æ—à–∏–±–æ–∫
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ environment variables**
6. **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –¥–µ–ø–ª–æ—è
7. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
8. **–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤** –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏