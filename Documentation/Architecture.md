# Документация по архитектуре проекта "Brend AI Bot"

## Обзор проекта

**Brend AI Bot** - это телеграм-бот на Python, использующий фреймворк aiogram(со встроенным ИИ) для поиска и анализа информации из различных источников (Wikipedia, DuckDuckGo). Бот специализируется на предоставлении структурированной информации о брендах, сравнении понятий и поиске исторических данных.

## Архитектурные компоненты

### 1. **Уровень представления (Presentation Layer)**
- **Фреймворк**: aiogram 3.x
- **Компоненты**:
  - `Bot` - основной объект бота
  - `Dispatcher` - обработчик сообщений и команд
  - `ReplyKeyboardMarkup` - клавиатуры для взаимодействия

### 2. **Бизнес-логика (Business Logic Layer)**
#### Обработчики сообщений:
- `start_handler` - инициализация бота
- `search_start` - начало процесса поиска
- `project_info` - информация о проекте
- `return_to_menu` - возврат в главное меню
- `brand_handler` - основной обработчик поисковых запросов

#### Аналитические функции:
- `analyze_complex_query()` - анализ типа запроса пользователя
- Определяет: сравнение, исторический запрос, общий поиск

### 3. **Сервисный слой (Service Layer)**
#### Поисковые сервисы:
- `fetch_difference_info()` - сравнение двух понятий
- `fetch_single_term_info()` - поиск информации об одном термине
- `fetch_history_info()` - поиск исторических данных
- `fetch_brand_info()` - основной поиск информации

### 4. **Слой данных (Data Layer)**
#### Внешние API:
- **Wikipedia REST API** (ru/en) - получение структурированных данных
- **DuckDuckGo Instant Answer API** - резервный источник информации

## Детали реализации

### Анализ запросов
```python
def analyze_complex_query(text: str) -> dict
```
**Поддерживаемые паттерны:**
- Сравнение: "разница между X и Y", "X vs Y"
- История: "история X", "когда появился X"
- Общие запросы: произвольный текст

### Поток обработки запроса
1. **Получение сообщения** → `brand_handler`
2. **Анализ типа** → `analyze_complex_query`
3. **Определение стратегии поиска** (сравнение/история/общий)
4. **Выполнение поиска** через соответствующий сервис
5. **Форматирование и отправка** Через сервер и библиотку

### Клавиатуры интерфейса
- **Главное меню**: Поиск + Информация о проекте
- **Вторичное меню**: Кнопка возврата в главное меню

### Логирование
- Уровень: INFO
- Библиотека: стандартный logging

## Обработка ошибок

### Механизмы resilience:
- Таймауты запросов (1 секунда)
- Множественные источники данных (fallback стратегия)
- Структурированное логирование исключений
- Graceful degradation при недоступности API

### Последовательность источников:
1. Русская Wikipedia → 2. Английская Wikipedia → 3. DuckDuckGo

## Особенности архитектуры

### Асинхронность
- Полностью асинхронная реализация на asyncio
- Использование aiohttp для HTTP-запросов
- Неблокирующая обработка множественных запросов

### Модульность
- Четкое разделение ответственности между функциями
- Возможность легкого расширения функциональности
- Изолированные сервисы поиска

### Масштабируемость
- Легко добавлять новые типы запросов
- Простое подключение дополнительных источников данных
- Гибкая система анализа текста

## Безопасность

- Валидация пользовательского ввода
- Кодирование URL-параметров
- Настройки User-Agent для API-запросов
- Обработка исключений на всех уровнях

## Ограничения и зависимости

### Внешние зависимости:
- aiogram 3.x - фреймворк Telegram Bot API и AI
- aiohttp - асинхронные HTTP-запросы
- re - регулярные выражения для анализа текста

### Ограничения:
- Зависимость от внешних API
- Ограничения по длине сообщений Telegram
- Базовая обработка естественного языка

## Возможности расширения

1. **Добавление новых источников данных**
2. **Улучшение NLP для анализа запросов**
3. **Кэширование результатов**
4. **Поддержка дополнительных языков**
5. **Интеграция с базами данных**

Проект демонстрирует чистую архитектуру с четким разделением слоев и хорошо структурированным кодом, что облегчает поддержку и дальнейшее развитие.